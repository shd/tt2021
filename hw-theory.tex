\documentclass[10pt,a4paper,oneside]{article}
\usepackage[utf8]{inputenc}
\usepackage[english,russian]{babel}
\usepackage{amsmath}
\usepackage{amsthm}
\usepackage{amssymb}
\usepackage{enumerate}
\usepackage{stmaryrd}
\usepackage{cmll}
\usepackage{mathrsfs}
\usepackage{hyperref}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm,bindingoffset=0cm]{geometry}
\usepackage{proof}
\usepackage{tikz}
\usepackage{multicol}

\makeatletter
\newcommand{\dotminus}{\mathbin{\text{\@dotminus}}}

\newcommand{\@dotminus}{%
  \ooalign{\hidewidth\raise1ex\hbox{.}\hidewidth\cr$\m@th-$\cr}%
}
\makeatother

\usetikzlibrary{arrows,backgrounds,patterns,matrix,shapes,fit,calc,shadows,plotmarks}

\newtheorem{definition}{Определение}
\begin{document}

\begin{center}{\Large\textsc{\textbf{Теоретические домашние задания}}}\\
             \it Теория типов, ИТМО, М3235-М3239, осень 2021 года\end{center}

\section*{Домашнее задание №1: <<вводная лекция>>}

\begin{enumerate}

\item Напомним правила расстановки скобок в лямбда-выражениях. Лямбда-абстракция ведёт себя жадно: 
включает всё, что может. Пример: $\lambda z.(\lambda x.a\ b\ c\ \lambda y.d\ e)\ f$ 
эквивалентно $\lambda z.((\lambda x.(a\ b\ c\ (\lambda y.(d\ e))))\ f)$.
В аппликациях скобки расставляются слева направо:
$\lambda z.(\lambda x.(a\ b\ c\ (\lambda y.(d\ e))))\ f$ можно преобразовать в  
$(\lambda z.((\lambda x.((((a\ b)\ c)\ (\lambda y.(d\ e)))))\ f))$.

\begin{enumerate}
\item Расставьте скобки в выражении:
$\lambda z.\lambda x.a\ b\ c\ \lambda y.d\ e\ f$
\item Уберите все <<лишние>> скобки из выражения:
$(\lambda f.((\lambda x.(f\ (f\ (x\ (\lambda z.(z\ x))))))\ z))$
\item Всегда ли лишние скобки можно убрать единственным образом (когда из результирующего
выражения нельзя больше убрать ни одной пары скобок)? Докажите или опровергните.
\end{enumerate}

\item Напомним определения с лекций:

\begin{tabular}{lll}
Обозначение & лямбда-терм & название\\\hline
$T$ & $\lambda a.\lambda b.a$ & истина\\
$F$ & $\lambda a.\lambda b.b$ & ложь\\
$Not$ & $\lambda x.x\ F\ T$ & отрицание\\
$And$ & $\lambda x.\lambda y.x\ y\ F$ & конъюнкция
\end{tabular}

Проредуцируйте следующие выражения и найдите нормальную форму:

\begin{enumerate}
\item $T\ F$
\item $(T\ Not\ (\lambda t.t))\ F$
\item $And\ (And\ F\ F)\ T$
\end{enumerate}

\item Постройте лямбда-выражения для следующих булевских выражений:
\begin{enumerate}
\item Дизъюнкция
\item Штрих Шеффера (<<и-не>>)
\item Исключающее или
\end{enumerate}

\item Напомним определения с лекций:

$$f^{(n)}\ X ::= \left\{\begin{array}{ll} X, & n=0\\
                                f^{(n-1)}\ (f\ X), & n>0\end{array}\right.$$

\begin{center}\begin{tabular}{lll}
Обозначение & лямбда-терм & название\\\hline
$\overline{n}$ & $\lambda f.\lambda x.f^{(n)}\ x$ & чёрчевский нумерал\\
$(+1)$ & $\lambda n.\lambda f.\lambda x.n\ f\ (f\ x)$ & прибавление 1\\
$(+)$ & $\lambda a.\lambda b.a\ (+1)\ b$ & сложение\\
$(\cdot)$ & $\lambda a.\lambda b.a\ ((+)\ b)\ \overline{0}$ & умножение
\end{tabular}\end{center}

Используя данные определения, постройте выражения для следующих операций над числами:

\begin{enumerate}
\item Умножение на 2 ($Mul2$)
\item Возведение в степень
\item Проверка на чётность
\item IsZero: возвращает $T$, если аргумент равен нулю, иначе $F$
\end{enumerate}

\item Напомним определения с лекций:

\begin{tabular}{lll}
Обозначение & лямбда-терм & название\\\hline
$MkPair$ & $\lambda a.\lambda b.(\lambda x.x\ a\ b)$ & создание пары\\
$PrL$ & $\lambda p.p\ T$ & левая проекция\\
$PrR$ & $\lambda p.p\ F$ & правая проекция\\\hline
\end{tabular}

\begin{enumerate}
\item Убедитесь, что $PrL\ (MkPair\ a\ b) \twoheadrightarrow_\beta a$.
\item Постройте операцию вычитания 1 из числа
\item Постройте операцию вычитания чисел
\item Постройте операцию деления на 3 (могут потребоваться пары и/или вычитания)
\item Постройте операцию деления чисел
\item Сравнение двух чисел ($IsLess$) — истина, если первый аргумент меньше второго.
\end{enumerate}

\item Существует ли выражение $A$, что существуют такие выражения $B$ и $C$, что
$A \rightarrow_\beta B$ и $A \rightarrow_\beta C$, но $B$ и $C$ различны?

\item Будем говорить, что лямбда-выражение находится в нормальной форме, если в нём невозможно
провести бета-редукции. Нормальной формой выражения называется результат (возможно, многократной)
его бета-редукции, находящийся в нормальной форме. 
Проредуцируйте выражение и найдите его нормальную форму: 
\begin{enumerate}
\item $\overline{2}\ \overline{2}$
\item $\overline{2}\ \overline{2}\ \overline{2}$
\item $\overline{2}\ \overline{2}\ \overline{2}\ \overline{2}\ \overline{2}\ \overline{2}\ \overline{2}$
\end{enumerate}

\item Напомним определение Y-комбинатора: $\lambda f.(\lambda x.f\ (x\ x))\ (\lambda x.f\ (x\ x))$.
Напомним, что отношение бета-эквивалентности $(=_\beta)$ есть транзитивное, рефлексивное и симметричное
замыкание отношения бета-редукции. Будем говорить, что выражение не имеет нормальной формы, если
никакая конечная последовательность его бета-редукций не приводит к выражению в нормальной форме.
\begin{enumerate}
\item Покажите, что $Y\ f =_\beta f\ (Y\ f)$.
\item Покажите, что выражение $Y\ f$ не имеет нормальной формы;
\item Покажите, что выражение $Y\ (\lambda f.\overline{0})$ имеет нормальную форму.
\item Покажите, что выражение $Y\ (\lambda f.\lambda x.(IsZero\ x)\ \overline{0}\ (f\ Minus1\ x))\ 2$ имеет нормальную форму.
\item Какова нормальная форма выражения $Y\ (\lambda f.\lambda x.(IsZero\ x)\ \overline{0}\ ((+1)\ (f\ (Minus1\ x))))\ \overline{n}$?
\item Какова нормальная форма выражения $Y\ (\lambda f.\lambda x.(IsZero\ x)\ \overline{1}\ (Mul2\ (f\ (Minus1\ x))))\ \overline{n}$?
\item Определите с помощью $Y$-комбинатора функцию для вычисления $n$-го числа Фибоначчи.
\end{enumerate}

\item Определим на языке Хаскель следующую функцию: \verb!show_church n = show (n (+1) 0)!
Убедитесь, что \verb!show_church (\f -> \x -> f (f x))! вернёт 2. 
Пользуясь данным определением и его идеей, реализуйте следующие функции:

\begin{enumerate}
\item \verb!int_to_church! --- возвращает чёрчевский нумерал (т.е. функцию от двух аргументов) по целому числу.
Каков точный тип результата этой функции?
\item сложение двух чёрчевских нумералов.
\item умножение двух чёрчевских нумералов.
\item можно ли определить функцию вычитания 1 и вычитания двух чисел? Что получается, а что --- нет?
\end{enumerate}

\item Бесконечное количество комбинаторов неподвижной точки. Дадим следующие определения
$$\begin{array}{l}
L := \lambda abcdefghijklmnopqstuvwxyzr.r(thisisafixedpointcombinator)\\
R := LLLLLLLLLLLLLLLLLLLLLLLLLL\end{array}$$
В данном определении терм $R$ является комбинатором неподвижной точки: каков бы ни был терм
$F$, выполнено $R\ F =_\beta F\ (R\ F)$.
\begin{enumerate}
\item Докажите, что данный комбинатор --- действительно комбинатор неподвижной точки.
\item Пусть в качестве имён переменных разрешены русские буквы. Постройте аналогичное выражение
по-русски: с 32 параметрами (без ё) и осмысленной русской фразой в терме $L$; покажите, что оно является
комбинатором неподвижной точки.
\end{enumerate}

\item Дадим определение: комбинатор --- лямбда-выражение без свободных переменных.

Также напомним определение:
$$\begin{array}{l}
S := \lambda x.\lambda y.\lambda z.x\ z\ (y\ z)\\
K := \lambda x.\lambda y.x\\
I := \lambda x.x
\end{array}$$

Известна теорема о том, что для любого комбинатора $X$ можно найти выражение $P$
(состоящее только из скобок, пробелов и комбинаторов $S$ и $K$), что $X =_\beta P$.
Будем говорить, что комбинатор $P$ \emph{выражает} комбинатор $X$ в базисе $SK$.

Выразите в базисе $SK$:
\begin{enumerate}
\item $F = \lambda x.\lambda y.y$
\item $\overline{1}$
\item $Not$
\item $Xor$
\item $InL$
\item $\overline{n}$
\end{enumerate}

\end{enumerate}

\section*{Домашнее задание №2: <<формализация лямбда-исчисления>>}

\begin{enumerate}
\item Придумайте грамматику для лямбда-выражений, однозначно разбирающую любое выражение
(в частности, учитывающую все сокращения скобок в записи).
\item Приведите пример лямбда-выражения, корректная бета-редукция которого невозможна без переименования
связанных переменных. Возможно ли, чтобы в этом выражении все переменные в лямбда-абстракциях
были различными?
\item Два выражения $A$ и $B$ назовём родственными, если существует $C$, что
$A \twoheadrightarrow_\beta C$ и $B \twoheadrightarrow_\beta C$.
Как соотносится родственность и бета-эквивалентность? 

\item Рассмотрим представление лямбда-выражений де Брауна (de Bruijn): вместо имени связанной переменной будем 
указывать число промежуточных лямбда-абстракций между связывающей абстрацией и переменной.
Например, $\lambda x.\lambda y.y\ x$ превратится в $\lambda.\lambda.0\ 1$.

Докажите, что $A =_\alpha B$ тогда и только тогда, когда представления де Брауна для $A$ и $B$ совпадают.
Сформулируйте правила (алгоритмы) для подстановки термов и бета-редукции для этого представления.

\item Как мы знаем, $\Omega \rightarrow_\beta \Omega$. А существуют ли такие лямбда-выражения
$A$ и $B$ ($A \ne_\alpha B$), что $A \rightarrow_\beta B$ и $B \rightarrow_\beta A$?

\item Рассмотрим следующие лямбда-выражения для задания алгебраических типов:

\begin{tabular}{lll}
Обозначение & лямбда-терм & название\\\hline
$Case$ & $\lambda l.\lambda r.\lambda c.c\ l\ r$ & сопоставление с образцом\\
$InL$ & $\lambda l.(\lambda x.\lambda y.x\ l)$ & левая инъекция\\
$InR$ & $\lambda r.(\lambda x.\lambda y.y\ r)$ & правая инъекция\\
\end{tabular}

Сопоставление с образцом --- это функция от значения алгебраического типа и двух действий $l$ и $r$, 
которая выполняет действие $l$, если значение создано <<левым>> конструктором, и $r$ в случае
<<правого>> конструктора. Иными словами, $Case\ l\ r\ c$ --- это аналог
\verb!case c { InL x -> l x; InR x -> r x }!.

Заметим, что список (например, целых чисел) — это алгебраический тип: 

\verb!List = Nil | Cons Integer List!.

Можно сконструировать значение данного типа: \verb!Cons 3 (Cons 5 Nil)!.
Можно, например, вычислить его длину:
\begin{verbatim}
length Nil = 0
length (Cons _ tail) = length tail + 1
\end{verbatim}

Определим $Nil = InL\ 0$, а $Cons\ a\ b = InR\ (MkPair\ a\ b)$. Заметим, что теперь списки могут быть впрямую
перенесены в лямбда выражения. 

Определите следующие функции в лямбда-исчислении для списков:
\begin{enumerate}
\item вычисление длины списка;
\item построение списка длины $n$ из элементов $0, 1, 2, \dots, n-1$;
\item разворот списка: из списка $a_1, a_2, \dots, a_n$ сделать список $a_n, a_{n-1}, \dots, a_1$;
\item функцию высшего порядка $map$, которая по функции $f$ и списку $a_1, a_2, \dots, a_n$
строит список $f(a_1), f(a_2), \dots, f(a_n)$.
\end{enumerate}

Решением задачи является полный текст соответствующего лямбда-выражения с объяснениями механизма его работы.
Используйте интерпретатор лямбда-выражений $lci$ или аналогичный для демонстрации результата.

\item Чёрчевские нумералы соответствуют натуральным числам в аксиоматике Пеано.
\begin{enumerate}
\item Предложите <<двоичные нумералы>> --- способ кодирования чисел, аналогичный двоичной системе 
(такой, при котором длина записи числа соответствует логарифму числового значения).
\item Предложите реализацию функции (+1) в данном представлении.
\item Предложите реализацию лямбда-выражения преобразования числа из двоичного нумерала в чёрчевский.
\end{enumerate}

Аналогично прошлому заданию, решение должно содержать полный код лямбда-выражения вместе с объяснением механизма его работы.

\end{enumerate}

\section*{Домашнее задание №3: <<просто-типизированное лямбда исчисление>>}

\begin{enumerate}
\item Оцените временн\'{у}ю сложность сложения, вычитания, умножения, деления, вычисления факториала 
(реализация с помощью $Y$-комбинатора) для чёрчевских нумералов в лямбда-исчислении.

\item Докажите обитаемость следующих типов с помощью вывода 
в просто-типизированном лямбда-исчислении и с помощью программы на Хаскеле.
\begin{enumerate}
\item $(\alpha\rightarrow\beta\rightarrow\gamma)\rightarrow(\beta\rightarrow\alpha\rightarrow\gamma)$
\item $(\alpha\rightarrow\alpha\rightarrow\beta)\rightarrow(\alpha\rightarrow\beta)$
\end{enumerate}

\item Лемма о расширении типа: докажите, что если $\Gamma\vdash A:\tau$, $\Gamma\vdash B: \sigma$,
$A \rightarrow_\beta B$, то $\Gamma\vdash A: \sigma$.

\item Верно ли, что если $A =_\beta B$, $\vdash A: \tau$ и $\vdash B: \sigma$, то $\vdash B: \tau$? 
Докажите или приведите опровергающий контрпример.

\item Рассмотрим остальные базовые логические связки ($\with$, $\vee$, $\bot$) и соответствующие
им расширенные лямбда-выражения:

\vspace{2mm}
\begin{tabular}{cp{5mm}cp{5mm}c}
	\infer{\Gamma \vdash \langle A, B \rangle: \varphi \with \psi}{\Gamma\vdash A: \varphi \;\;\;\; \Gamma\vdash B: \psi} &&
	\infer{\Gamma \vdash \pi_l \langle A, B \rangle : \varphi}{\Gamma \vdash \langle A, B \rangle: \varphi \with \psi} &&
	\infer{\Gamma \vdash \pi_r \langle A, B \rangle : \psi}{\Gamma \vdash \langle A, B \rangle: \varphi \with \psi}
\\ \\
	\infer{\Gamma \vdash \textbf{in}_l \; A: \varphi \vee \psi}{\Gamma\vdash A: \varphi}&&
	\infer{\Gamma \vdash \textbf{in}_r \; B: \varphi \vee \psi}{\Gamma\vdash B: \psi}&&
	\infer{\textbf{case} \; L \; f \; g : \tau}{\Gamma \vdash L: \varphi \vee \psi \;\;\; \Gamma \vdash f : \varphi \to \tau \;\;\; \Gamma \vdash g: \psi \to \tau}

\\ \\
 &&	\infer{\Gamma \vdash A : \tau}{\Gamma \vdash A: \bot}

\end{tabular}
\vspace{2mm}

Конструкции $\langle A,B\rangle$, $\textbf{case}$ и им подобные --- это новые конструкции для записи выражений:
запись $\lambda x.\langle x,\lambda y.\textbf{in}_l\ x\rangle$ вполне возможна.
Конечно, в бестиповом исчислении $\langle A,B\rangle$ может быть задано как терм $\lambda p.p\ A\ B$, но
в просто-типизированном исчислении выразительной силы языка для его типизации не хватит, потому
мы ввели специальные конструкции со своими специальными правилами типизации.
Заметьте, что правила введения лжи не существует (иначе теория станет противоречивой).

В каждом из подзаданий напишите: (i) лямбда-выражения, доказывающие утверждения,
(ii) соответствующие им программы на Хаскеле, (iii) а также покажите, что эти выражения действительно имеют соответствующий тип
($\alpha\rightarrow\bot$ обозначим как $\neg\alpha$).
\begin{enumerate}
\item $\alpha\vee\beta\rightarrow\neg(\neg\alpha\with\neg\beta)$
\item $\alpha\with\beta\rightarrow\neg(\neg\alpha\vee\neg\beta)$
\item $\alpha\with(\beta\vee\gamma)\rightarrow(\alpha\with\beta)\vee(\alpha\with\gamma)$
\item $(\alpha\rightarrow\beta)\rightarrow(\neg\beta\rightarrow\neg\alpha)$
\item $\alpha\rightarrow\neg\alpha\rightarrow\beta$
\end{enumerate}

\item Зафиксируем атомарный тип $\alpha$ и определим $\eta$ как $(\alpha\rightarrow\alpha)\rightarrow(\alpha\rightarrow\alpha)$.
Пусть $\vdash A:\eta\rightarrow\eta\rightarrow\eta$, $M\equiv\overline{m}$, $N\equiv\overline{n}$, и $f$ --- некоторая
свободная переменная типа $\alpha\rightarrow\alpha$.
Покажите, что:
\begin{enumerate}
\item Cложение и умножение имеют тип $\eta\rightarrow\eta\rightarrow\eta$ (указание: не каждая реализация этих операций имеет такой тип).
\item Любое подвыражение внутри нормальной формы $A\ M\ N\ f$ имеет тип либо $\alpha$, либо $\alpha\rightarrow\alpha$, либо $\eta$.
\item Тип $\eta$ внутри нормальной формы $A\ M\ N\ f$ могут иметь только термы $M$ и $N$.
\item Тип $\alpha\rightarrow\alpha$ внутри нормальной формы $A\ M\ N\ f$ могут иметь только термы 
\begin{enumerate}\item $f$; \item $M\ X$ и $N\ X$ при некотором $X$;
\item $\lambda x.S_1\ (S_2\ \dots (S_k\ y)\ ))$, где $S_i \equiv h$, либо $S_i \equiv M\ X$, либо $S_i \equiv N\ X$ при некотором $X$.\end{enumerate}
\item Обозначим за $X^n(x)$ $n$-кратное применение $X$ к аргументу $x$, а за $P(m,n)$ --- полином от $m$ и $g$.
Тогда любое выражение $S: \alpha\rightarrow\alpha$, являющееся подвыражением нормальной формы $A\ M\ N\ f$, есть либо полином применений $f$
к аргументу ($S =_\beta \lambda x.f^{P(m,n)}(x)$), либо константная функция ($S =_\beta \lambda x.f^{P(m,n)}(y)$, $x \not\equiv y$).
\item Пусть $E(m,n)$ --- \emph{расширенный полином} ($P_i$ --- натуральные полиномы, $c$ --- некоторая натуральная константа):
$$E(m,n) = \left\{\begin{array}{ll}P_1(m,n)&m > 0,\ n > 0\\P_2(m)&m > 0,\ n =0\\P_3(n)&m = 0,\ n > 0\\c&m = 0,\ n = 0\end{array}\right.$$
Покажите, что любая функция, имеющая тип $\eta$, вычисляет некоторый расширенный полином.
То есть, если $A:\eta\rightarrow\eta\rightarrow\eta$, то найдётся такой $E(m,n)$, что при всех $m,n \in \mathbb{N}_0$ выполнено
$A\ M\ N =_\beta \overline{E(m,n)}$.
\end{enumerate}

\end{enumerate}

\section*{Домашнее задание №4: <<просто-типизированное лямбда исчисление>>}
\begin{enumerate}
\item Сформулируйте аксиомы для просто типизированного исчисления по Чёрчу. 
\emph{Указание:} аксиомы должны быть согласованы с типами аргументов
лямбда-абстракций.
\item Рассмотрим типизацию по Чёрчу. Определим стирающее преобразование $|\cdot|: \Lambda \rightarrow \Lambda_\textrm{ч}$:

$$|A| = \left\{ \begin{array}{ll} \alpha,& A = \alpha\\
                                  |P| |Q|,& A = P Q\\
                                  \lambda x.|P|,& A = \lambda x^\tau.P \end{array}  \right.$$

Верно ли следующее: если $P \rightarrow_\beta Q$ и $|P'|=P$, $|Q'|=Q$, то $P'\rightarrow_\beta Q'$.
\item Покажите, что если $A =_\alpha B$ и $\Gamma\vdash A:\tau$, то $\Gamma\vdash B:\tau$ (или, иными словами,
доказательство не зависит от выбора пред-лямбда-терма).
\end{enumerate}

\end{document}
